// Listmerger v0.1 CommonJS
"use strict";let e;function t(){let e=document.createElement("div");return e.classList.add("draghandle"),e.draggable=!0,e.innerHTML="H",e}function n(e){let t=e.target.value;document.querySelectorAll(".tabbar details")[t].setAttribute("open","1")}function d(e,t){let n=e.target.classList;null!=n&&(e.target.parentElement.classList.contains("element")&&(n=e.target.parentElement.classList),n.contains("drag")?n.remove("drag"):(n.contains("zone")||n.contains("element"))&&e.target.id!=t&&n.add("drag"))}function i(e){const t=document.getElementById(e);return[...t.parentElement.children].indexOf(t)}function o(n,d=!1){d||v();let i=document.getElementById(n),o=document.getElementById(e).querySelector(".zone"),r=i.cloneNode(!0);r.id="merged-"+r.id,r.setAttribute("data-origin",n),r.classList.remove("dragg"),r.append(t()),o.append(r),i.classList.add("added")}function r(e){document.getElementById(e).classList.remove("added"),document.getElementById("merged-"+e).remove()}function l(e,t=!1){t||v();let n=[];return e.forEach(e=>{e.classList.contains("added")||e.classList.contains("merged")||(o(e.id,t),n.push(e.id))}),n}function a(e,n,d,i=!1,o=""){i||v();let r=document.getElementById(e),l=!0,a=E(e),s=E(n);if(null==a){let t=document.getElementById(e).getAttribute("data-origin"),n=document.getElementById(t);n.classList.remove("added"),n.classList.add("merged"),a={id:e,title:n.innerHTML,origin:n.id}}if(null==s){let e=document.getElementById(n).getAttribute("data-origin");null==e&&(e=n,l=!1);let t=document.getElementById(e);t.classList.remove("added"),t.classList.add("merged"),s={id:n,title:t.innerHTML,origin:t.id}}let c="mm-"+e+"+"+n;var g;return""!=o&&(c=o),g={id:c,title:d,historyA:a,historyB:s},u[c]=g,r.innerText=d,r.append(t()),r.removeAttribute("data-origin"),r.id=c,l&&document.getElementById(n).remove(),c}function s(e){console.log("unmerge");let n=E(e),d=document.getElementById(e);if(n.historyA.id.startsWith("merged-")&&(d.setAttribute("data-origin",n.historyA.origin),document.getElementById(n.historyA.origin).classList.remove("merged"),document.getElementById(n.historyA.origin).classList.add("added")),(n.historyA.id.startsWith("mm-")||n.historyA.id.startsWith("merged-"))&&(d.id=n.historyA.id,d.innerText=n.historyA.title,d.append(t())),n.historyB.id.startsWith("merged-")||n.historyB.id.startsWith("mm-")){let e=document.createElement("div");e.innerText=n.historyB.title,e.id=n.historyB.id,e.draggable=!0,e.append(t()),null!=n.historyB.origin&&(document.getElementById(n.historyB.origin).classList.remove("merged"),document.getElementById(n.historyB.origin).classList.add("added"),e.setAttribute("data-origin",n.historyB.origin)),document.getElementById("mlist").append(e)}else{document.getElementById(n.historyB.id).classList.remove("merged")}!function(e){delete u[e]}(e)}function c(e,t,n=!1){const d=document.getElementById(e),i=d.parentElement;let o=[...i.children][t];n&&(o=o.nextSibling),i.insertBefore(d,o)}var g;function m(){h(),document.getElementById("undo").addEventListener("click",e=>{e.preventDefault(),function(){let e=y.pop();if(null==e)return;"move"==e.action?r(e.id1):"move_all"==e.action?e.array.forEach(e=>{r(e)}):"merge"==e.action?s(e.id3):"arrange"==e.action&&c(e.id1,+e.id2);f.push(e),console.log("<< undo"),console.log(y),console.log(f),h()}()}),document.getElementById("redo").addEventListener("click",e=>{e.preventDefault(),function(){let e=f.pop();if(null==e)return;if(y.push(e),"move"==e.action)o(e.id1,!0);else if("move_all"==e.action){l(document.getElementById(e.id1).querySelectorAll("[data-role='finding']"),!0)}else"merge"==e.action?a(e.id1,e.id2,e.title,!0,e.id3):"arrange"==e.action&&c(e.id1,+e.id3,!0);console.log(">> redo"),console.log(y),console.log(f),h()}()})}Object.defineProperty(exports,"__esModule",{value:!0}),function(e){e[e.Move=0]="Move",e[e.UnMove=1]="UnMove",e[e.MoveAll=2]="MoveAll",e[e.Merge=3]="Merge",e[e.UnMerge=4]="UnMerge"}(g||(g={}));let u={},y=[],f=[];function v(){f=[]}function E(e){return u[e]}function h(){let e=document.getElementById("undo"),t=document.getElementById("redo");e.disabled=0==y.length,t.disabled=0==f.length}function L(e,t="",n="",d="",i=[],o=""){y.push({action:e,id1:t,id2:n,id3:d,array:i,title:o}),console.log("history"),console.log(y),console.log(f),h()}let p,B,I="",A="",b="",S=-1;function q(){p=document.querySelector("#mlist"),function(){B=document.querySelector("dialog");const e=document.querySelector("dialog button#closebutton"),t=document.querySelector("#mergebutton");e.addEventListener("click",W),t.addEventListener("click",k)}(),function(){const t=document.getElementById(e),n=t.querySelector(".mergelist");t.addEventListener("dragstart",M),t.addEventListener("dragend",T),n.addEventListener("dragenter",D),n.addEventListener("dragleave",D),n.addEventListener("dragover",x),n.addEventListener("drop",H)}(),document.querySelectorAll(".moveall").forEach(e=>{e.addEventListener("click",_)})}function M(e){let t=e.target;"DIV"!=t.nodeName||t.classList.contains("added")||t.classList.contains("merged")?e.preventDefault():(I=t.id,t.classList.contains("draghandle")?(p=document.querySelector("#mlist"),b="handle",I=t.parentElement.id,S=i(I),setTimeout(()=>t.parentElement.classList.add("dragging"),0)):(b="move",document.getElementById(I).classList.add("dragg")))}function T(e){document.getElementById(I).classList.remove("dragging"),I=e.target.id,""!=I&&document.getElementById(I).classList.remove("dragg")}function D(e){"move"==b&&d(e,I)}function x(e){if(e.preventDefault(),"move"==b)return;const t=document.querySelector(".dragging");let n=[...p.querySelectorAll(".element:not(.dragging)")].find(t=>e.clientY<=t.offsetTop+t.offsetHeight/2);p.insertBefore(t,n)}function H(e){if("handle"==b){let e=i(I);return void(S!=e&&L("arrange",I,S.toString(),e.toString()))}d(e,I);let t=document.getElementById(I),n=e.target;if(I!=n.id){if(console.log(n),n.classList.contains("draghandle")&&(n=n.parentElement),"finding"==n.getAttribute("data-role")){const e=document.querySelector("#mergeplaceholder");return A=n.id,e.innerHTML=" (ID "+n.id+" and ID "+I+")",B.querySelector("input[name='newtitle']").value="Merged findings "+n.id+" and "+I,void B.showModal()}"zone"!=n.getAttribute("data-role")&&"mlist"!=n.id||t.parentElement.id!=n.id&&(t.classList.contains("added")||t.classList.contains("merged")||(o(I),L("move",I)))}}function k(e){e.preventDefault();let t=document.getElementById(A),n=t.id,d=document.getElementById(I),i=B.querySelector("input[name='newtitle']"),o=I;if(d.hasAttribute("data-origin")){o=d.getAttribute("data-origin");let e=document.getElementById(o);e.classList.remove("added"),e.classList.add("merged")}else d.classList.add("merged");let r=a(t.id,I,i.value);L("merge",n,I,r,[],i.value),B.close()}function W(e){e.preventDefault(),B.close()}function _(e){let t=e.target.parentNode.querySelectorAll("[data-role='finding']");if(0==t.length)return;let n=l(t);n.length&&L("move_all",e.target.nextElementSibling.id,"","",n)}exports.init=function(t,d,i){!function(t){e=t}(t),q(),function(e){const t=document.querySelectorAll("details"),d=document.querySelector("#detailsselector");d.addEventListener("change",n),t.forEach(e=>{e.addEventListener("toggle",t=>{e.open&&(d.nodeValue=e.dataset.order)})}),new ResizeObserver(e=>{e.forEach(e=>{const t=e.target.querySelectorAll("summary");t[0].offsetTop==t[t.length-1].offsetTop?e.target.classList.remove("compact"):e.target.classList.add("compact")})}).observe(document.querySelector(e))}(".tablist"),m()};
//# sourceMappingURL=listmerger.gZip.js.map
