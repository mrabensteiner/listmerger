// Listmerger v0.1 IIFE
var listmerger=function(e){"use strict";let t;function n(){let e=document.createElement("div");return e.classList.add("draghandle"),e.draggable=!0,e.innerHTML="H",e}function d(e){let t=e.target.value;document.querySelectorAll(".tabbar details")[t].setAttribute("open","1")}function i(e,t){let n=e.target.classList;null!=n&&(e.target.parentElement.classList.contains("element")&&(n=e.target.parentElement.classList),n.contains("drag")?n.remove("drag"):(n.contains("zone")||n.contains("element"))&&e.target.id!=t&&n.add("drag"))}function o(e){const t=document.getElementById(e);return[...t.parentElement.children].indexOf(t)}function r(e,d=!1){d||E();let i=document.getElementById(e),o=document.getElementById(t).querySelector(".zone"),r=i.cloneNode(!0);r.id="merged-"+r.id,r.setAttribute("data-origin",e),r.classList.remove("dragg"),r.append(n()),o.append(r),i.classList.add("added")}function l(e){document.getElementById(e).classList.remove("added"),document.getElementById("merged-"+e).remove()}function a(e,t=!1){t||E();let n=[];return e.forEach(e=>{e.classList.contains("added")||e.classList.contains("merged")||(r(e.id,t),n.push(e.id))}),n}function s(e,t,d,i=!1,o=""){i||E();let r=document.getElementById(e),l=!0,a=h(e),s=h(t);if(null==a){let t=document.getElementById(e).getAttribute("data-origin"),n=document.getElementById(t);n.classList.remove("added"),n.classList.add("merged"),a={id:e,title:n.innerHTML,origin:n.id}}if(null==s){let e=document.getElementById(t).getAttribute("data-origin");null==e&&(e=t,l=!1);let n=document.getElementById(e);n.classList.remove("added"),n.classList.add("merged"),s={id:t,title:n.innerHTML,origin:n.id}}let c="mm-"+e+"+"+t;var g;return""!=o&&(c=o),g={id:c,title:d,historyA:a,historyB:s},y[c]=g,r.innerText=d,r.append(n()),r.removeAttribute("data-origin"),r.id=c,l&&document.getElementById(t).remove(),c}function c(e){console.log("unmerge");let t=h(e),d=document.getElementById(e);if(t.historyA.id.startsWith("merged-")&&(d.setAttribute("data-origin",t.historyA.origin),document.getElementById(t.historyA.origin).classList.remove("merged"),document.getElementById(t.historyA.origin).classList.add("added")),(t.historyA.id.startsWith("mm-")||t.historyA.id.startsWith("merged-"))&&(d.id=t.historyA.id,d.innerText=t.historyA.title,d.append(n())),t.historyB.id.startsWith("merged-")||t.historyB.id.startsWith("mm-")){let e=document.createElement("div");e.innerText=t.historyB.title,e.id=t.historyB.id,e.draggable=!0,e.append(n()),null!=t.historyB.origin&&(document.getElementById(t.historyB.origin).classList.remove("merged"),document.getElementById(t.historyB.origin).classList.add("added"),e.setAttribute("data-origin",t.historyB.origin)),document.getElementById("mlist").append(e)}else{document.getElementById(t.historyB.id).classList.remove("merged")}!function(e){delete y[e]}(e)}function g(e,t,n=!1){const d=document.getElementById(e),i=d.parentElement;let o=[...i.children][t];n&&(o=o.nextSibling),i.insertBefore(d,o)}var u;function m(){L(),document.getElementById("undo").addEventListener("click",e=>{e.preventDefault(),function(){let e=f.pop();if(null==e)return;"move"==e.action?l(e.id1):"move_all"==e.action?e.array.forEach(e=>{l(e)}):"merge"==e.action?c(e.id3):"arrange"==e.action&&g(e.id1,+e.id2);v.push(e),console.log("<< undo"),console.log(f),console.log(v),L()}()}),document.getElementById("redo").addEventListener("click",e=>{e.preventDefault(),function(){let e=v.pop();if(null==e)return;if(f.push(e),"move"==e.action)r(e.id1,!0);else if("move_all"==e.action){a(document.getElementById(e.id1).querySelectorAll("[data-role='finding']"),!0)}else"merge"==e.action?s(e.id1,e.id2,e.title,!0,e.id3):"arrange"==e.action&&g(e.id1,+e.id3,!0);console.log(">> redo"),console.log(f),console.log(v),L()}()})}!function(e){e[e.Move=0]="Move",e[e.UnMove=1]="UnMove",e[e.MoveAll=2]="MoveAll",e[e.Merge=3]="Merge",e[e.UnMerge=4]="UnMerge"}(u||(u={}));let y={},f=[],v=[];function E(){v=[]}function h(e){return y[e]}function L(){let e=document.getElementById("undo"),t=document.getElementById("redo");e.disabled=0==f.length,t.disabled=0==v.length}function p(e,t="",n="",d="",i=[],o=""){f.push({action:e,id1:t,id2:n,id3:d,array:i,title:o}),console.log("history"),console.log(f),console.log(v),L()}let B,I,A="",b="",S="",q=-1;function M(){B=document.querySelector("#mlist"),function(){I=document.querySelector("dialog");const e=document.querySelector("dialog button#closebutton"),t=document.querySelector("#mergebutton");e.addEventListener("click",_),t.addEventListener("click",W)}(),function(){const e=document.getElementById(t),n=e.querySelector(".mergelist");e.addEventListener("dragstart",T),e.addEventListener("dragend",D),n.addEventListener("dragenter",x),n.addEventListener("dragleave",x),n.addEventListener("dragover",H),n.addEventListener("drop",k)}(),document.querySelectorAll(".moveall").forEach(e=>{e.addEventListener("click",w)})}function T(e){let t=e.target;"DIV"!=t.nodeName||t.classList.contains("added")||t.classList.contains("merged")?e.preventDefault():(A=t.id,t.classList.contains("draghandle")?(B=document.querySelector("#mlist"),S="handle",A=t.parentElement.id,q=o(A),setTimeout(()=>t.parentElement.classList.add("dragging"),0)):(S="move",document.getElementById(A).classList.add("dragg")))}function D(e){document.getElementById(A).classList.remove("dragging"),A=e.target.id,""!=A&&document.getElementById(A).classList.remove("dragg")}function x(e){"move"==S&&i(e,A)}function H(e){if(e.preventDefault(),"move"==S)return;const t=document.querySelector(".dragging");let n=[...B.querySelectorAll(".element:not(.dragging)")].find(t=>e.clientY<=t.offsetTop+t.offsetHeight/2);B.insertBefore(t,n)}function k(e){if("handle"==S){let e=o(A);return void(q!=e&&p("arrange",A,q.toString(),e.toString()))}i(e,A);let t=document.getElementById(A),n=e.target;if(A!=n.id){if(console.log(n),n.classList.contains("draghandle")&&(n=n.parentElement),"finding"==n.getAttribute("data-role")){const e=document.querySelector("#mergeplaceholder");return b=n.id,e.innerHTML=" (ID "+n.id+" and ID "+A+")",I.querySelector("input[name='newtitle']").value="Merged findings "+n.id+" and "+A,void I.showModal()}"zone"!=n.getAttribute("data-role")&&"mlist"!=n.id||t.parentElement.id!=n.id&&(t.classList.contains("added")||t.classList.contains("merged")||(r(A),p("move",A)))}}function W(e){e.preventDefault();let t=document.getElementById(b),n=t.id,d=document.getElementById(A),i=I.querySelector("input[name='newtitle']"),o=A;if(d.hasAttribute("data-origin")){o=d.getAttribute("data-origin");let e=document.getElementById(o);e.classList.remove("added"),e.classList.add("merged")}else d.classList.add("merged");let r=s(t.id,A,i.value);p("merge",n,A,r,[],i.value),I.close()}function _(e){e.preventDefault(),I.close()}function w(e){let t=e.target.parentNode.querySelectorAll("[data-role='finding']");if(0==t.length)return;let n=a(t);n.length&&p("move_all",e.target.nextElementSibling.id,"","",n)}return e.init=function(e,n,i){!function(e){t=e}(e),M(),function(e){const t=document.querySelectorAll("details"),n=document.querySelector("#detailsselector");n.addEventListener("change",d),t.forEach(e=>{e.addEventListener("toggle",t=>{e.open&&(n.nodeValue=e.dataset.order)})}),new ResizeObserver(e=>{e.forEach(e=>{const t=e.target.querySelectorAll("summary");t[0].offsetTop==t[t.length-1].offsetTop?e.target.classList.remove("compact"):e.target.classList.add("compact")})}).observe(document.querySelector(e))}(".tablist"),m()},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=listmerger.gZip.js.map
